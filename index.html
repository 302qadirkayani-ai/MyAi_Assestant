<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Anime 3D Studio - Fixed</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            overflow: hidden;
            direction: rtl;
            color: white;
        }
        #container { width: 100vw; height: 100vh; display: flex; }
        #viewport { flex: 1; position: relative; background: #000; }
        #controls {
            width: 380px;
            background: rgba(15, 15, 30, 0.95);
            padding: 20px;
            overflow-y: auto;
            border-left: 2px solid #ff6b9d;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        h1 { font-size: 20px; color: #ff6b9d; text-align: center; margin-bottom: 20px; }
        h3 { font-size: 14px; color: #ffd93d; margin-bottom: 10px; }
        button {
            width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 5px; cursor: pointer;
            font-weight: bold; color: white; transition: 0.3s;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        button:hover { opacity: 0.8; transform: scale(1.02); }
        .character-btn { background: linear-gradient(135deg, #f093fb, #f5576c); }
        textarea {
            width: 100%; height: 80px; background: #000; color: #fff;
            border: 1px solid #ff6b9d; padding: 10px; border-radius: 5px;
        }
        .camera-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        #stats { position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 5px; font-size: 12px; }
        #voiceStatus { 
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            padding: 10px 20px; background: #4ade80; color: black; border-radius: 20px;
            display: none; font-weight: bold;
        }
    </style>
</head>
<body>

<div id="voiceStatus">ğŸ¤ Ø¢ÙˆØ§Ø² Ø±ÛŒÚ©Ø§Ø±Úˆ ÛÙˆ Ø±ÛÛŒ ÛÛ’...</div>
<div id="container">
    <div id="viewport">
        <div id="stats">Ú©Ø±Ø¯Ø§Ø±: <span id="charCount">0</span> | Ú©ÛŒÙ…Ø±Û: <span id="camName">ÙØ±Ù†Ù¹</span></div>
    </div>
    
    <div id="controls">
        <h1>ğŸŒ Ø§ÛŒÙ†ÛŒÙ…ÛŒ ØªÚ¾Ø±ÛŒ ÚˆÛŒ Ø§Ø³Ù¹ÙˆÚˆÛŒÙˆ</h1>
        
        <div class="section">
            <h3>ğŸ‘¥ Ú©Ø±Ø¯Ø§Ø± Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h3>
            <button class="character-btn" onclick="addCharacter('girl')">ğŸ‘§ Ù„Ú‘Ú©ÛŒ (18 Ø³Ø§Ù„)</button>
            <button class="character-btn" onclick="addCharacter('boy')">ğŸ‘¦ Ù„Ú‘Ú©Ø§ (18 Ø³Ø§Ù„)</button>
            <button class="character-btn" onclick="addCharacter('mother')">ğŸ‘© Ù…Ø§Úº (35 Ø³Ø§Ù„)</button>
            <button class="character-btn" onclick="addCharacter('father')">ğŸ‘¨ Ø¨Ø§Ù¾ (40 Ø³Ø§Ù„)</button>
            <button onclick="removeLastCharacter()" style="background: #eb3349;">Ú©Ø±Ø¯Ø§Ø± ÛÙ¹Ø§Ø¦ÛŒÚº</button>
        </div>

        <div class="section">
            <h3>âœ¨ AI Ø§Ø³Ú©Ø±Ù¾Ù¹ Ú©Ù†Ù¹Ø±ÙˆÙ„</h3>
            <textarea id="scriptInput" placeholder="Ù…Ø«Ø§Ù„: Ù„Ú‘Ú©ÛŒ Ú†Ù„ØªÛŒ ÛÛ’..."></textarea>
            <button onclick="executeScript()">ğŸ¬ Ø§Ø³Ú©Ø±Ù¾Ù¹ Ú†Ù„Ø§Ø¦ÛŒÚº</button>
            <button onclick="stopAllActions()" style="background: #555;">â¹ï¸ Ø±ÙˆÚ© Ø¯ÛŒÚº</button>
        </div>

        <div class="section">
            <h3>ğŸï¸ Ù…Ø§Ø­ÙˆÙ„</h3>
            <button onclick="changeEnvironment('city')">ğŸ™ï¸ Ø´ÛØ±</button>
            <button onclick="changeEnvironment('park')">ğŸŒ³ Ù¾Ø§Ø±Ú©</button>
            <button onclick="changeEnvironment('forest')">ğŸŒ² Ø¬Ù†Ú¯Ù„</button>
        </div>

        <div class="section">
            <h3>ğŸ“¹ Ú©ÛŒÙ…Ø±Û</h3>
            <div class="camera-controls">
                <button onclick="setCameraAngle('front')">ÙØ±Ù†Ù¹</button>
                <button onclick="setCameraAngle('back')">Ø¨ÛŒÚ©</button>
                <button onclick="setCameraAngle('top')">Ù¹Ø§Ù¾</button>
            </div>
            <button onclick="toggleCameraRotation()">ğŸ”„ Ø¢Ù¹Ùˆ Ø±ÙˆÙ¹ÛŒÙ¹: <span id="rotateStatus">Ø¢Ù</span></button>
        </div>

        <div class="section">
            <h3>ğŸ™ï¸ ÙˆØ§Ø¦Ø³ Ø§ÙˆØ± Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯</h3>
            <button onclick="toggleVoiceControl()" id="voiceBtn">ğŸ¤ Ø¢ÙˆØ§Ø² Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</button>
            <button onclick="toggleRecording()" id="recordBtn" style="background: #ff4757;">ğŸ”´ Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    let scene, camera, renderer, clock;
    let characters = [];
    let autoRotate = false;
    let isRecording = false;

    // Ú©Ø±Ø¯Ø§Ø±ÙˆÚº Ú©ÛŒ Ø§Ù‚Ø³Ø§Ù…
    const characterTypes = {
        girl: { color: 0xffb3d9, height: 1.6, hair: 0xff1493 },
        boy: { color: 0xadd8e6, height: 1.7, hair: 0x222222 },
        mother: { color: 0xffd1dc, height: 1.55, hair: 0x4b2e2a },
        father: { color: 0xb0c4de, height: 1.8, hair: 0x333333 }
    };

    // Ù¾Ø±ÙˆÚ¯Ø±Ø§Ù… Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº
    window.onload = init;

    function init() {
        scene = new THREE.Scene();
        clock = new THREE.Clock();
        
        // Ú©ÛŒÙ…Ø±Û Ø³ÛŒÙ¹ Ø§Ù¾
        camera = new THREE.PerspectiveCamera(60, (window.innerWidth - 380) / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 3, 10);

        // Ø±ÛŒÙ†ÚˆØ± Ø³ÛŒÙ¹ Ø§Ù¾
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth - 380, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('viewport').appendChild(renderer.domElement);

        // Ø±ÙˆØ´Ù†ÛŒØ§Úº
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        // ÚˆÛŒÙØ§Ù„Ù¹ Ø²Ù…ÛŒÙ†
        createGround(0x333333);
        
        window.addEventListener('resize', onWindowResize);
        animate();
        console.log("Ø§Ø³Ù¹ÙˆÚˆÛŒÙˆ ØªÛŒØ§Ø± ÛÛ’!");
    }

    function createGround(colorCode) {
        // Ù¾Ø±Ø§Ù†ÛŒ Ø²Ù…ÛŒÙ† ÛÙ¹Ø§Ø¦ÛŒÚº
        const oldGround = scene.getObjectByName("ground");
        if(oldGround) scene.remove(oldGround);

        const geometry = new THREE.PlaneGeometry(100, 100);
        const material = new THREE.MeshStandardMaterial({ color: colorCode });
        const ground = new THREE.Mesh(geometry, material);
        ground.rotation.x = -Math.PI / 2;
        ground.name = "ground";
        scene.add(ground);
    }

    function addCharacter(type) {
        if (characters.length >= 5) return alert("Ø²ÛŒØ§Ø¯Û Ú©Ø±Ø¯Ø§Ø± Ù†ÛÛŒÚº Ø¢ Ø³Ú©ØªÛ’!");
        
        const config = characterTypes[type];
        const group = new THREE.Group();

        // Ø¬Ø³Ù… (Body)
        const bodyGeo = new THREE.CylinderGeometry(0.3, 0.2, 1);
        const bodyMat = new THREE.MeshStandardMaterial({ color: config.color });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        body.position.y = 0.5;
        group.add(body);

        // Ø³Ø± (Head) - Anime Style
        const headGeo = new THREE.SphereGeometry(0.3);
        const headMat = new THREE.MeshStandardMaterial({ color: 0xffdbac });
        const head = new THREE.Mesh(headGeo, headMat);
        head.position.y = 1.2;
        group.add(head);

        // Ø¨Ø§Ù„ (Hair)
        const hairGeo = new THREE.BoxGeometry(0.35, 0.2, 0.35);
        const hairMat = new THREE.MeshStandardMaterial({ color: config.hair });
        const hair = new THREE.Mesh(hairGeo, hairMat);
        hair.position.y = 1.4;
        group.add(hair);

        group.position.x = (characters.length * 2) - 3;
        scene.add(group);
        characters.push(group);
        
        document.getElementById('charCount').innerText = characters.length;
    }

    function removeLastCharacter() {
        if (characters.length > 0) {
            const char = characters.pop();
            scene.remove(char);
            document.getElementById('charCount').innerText = characters.length;
        }
    }

    function changeEnvironment(env) {
        const envLabel = document.getElementById('envName');
        if (env === 'city') {
            scene.background = new THREE.Color(0x111122);
            createGround(0x333333);
        } else if (env === 'park') {
            scene.background = new THREE.Color(0x87ceeb);
            createGround(0x2d5a27);
        } else if (env === 'forest') {
            scene.background = new THREE.Color(0x0a2a0a);
            createGround(0x1a3300);
        }
    }

    function setCameraAngle(angle) {
        document.getElementById('camName').innerText = angle;
        if (angle === 'front') camera.position.set(0, 2, 8);
        else if (angle === 'back') camera.position.set(0, 2, -8);
        else if (angle === 'top') camera.position.set(0, 10, 0);
        camera.lookAt(0, 1, 0);
    }

    function toggleCameraRotation() {
        autoRotate = !autoRotate;
        document.getElementById('rotateStatus').innerText = autoRotate ? "Ø¢Ù†" : "Ø¢Ù";
    }

    function executeScript() {
        const input = document.getElementById('scriptInput').value;
        if(!input) return alert("Ú©Ú†Ú¾ Ù„Ú©Ú¾ÛŒÚº!");
        
        characters.forEach((char, index) => {
            // Ø³Ø§Ø¯Û Ø§ÛŒÙ†ÛŒÙ…ÛŒØ´Ù†: Ø§Ú†Ú¾Ù„Ù†Ø§
            let startTime = Date.now();
            const animateAction = () => {
                let elapsed = (Date.now() - startTime) / 1000;
                char.position.y = Math.abs(Math.sin(elapsed * 5)) * 0.5;
                if(elapsed < 3) requestAnimationFrame(animateAction);
                else char.position.y = 0;
            };
            animateAction();
        });
    }

    function stopAllActions() {
        location.reload(); // Ø³Ø¨ Ú©Ú†Ú¾ Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±Ù†Û’ Ú©Ø§ Ø¢Ø³Ø§Ù† Ø·Ø±ÛŒÙ‚Û
    }

    function toggleVoiceControl() {
        const status = document.getElementById('voiceStatus');
        const btn = document.getElementById('voiceBtn');
        if(status.style.display === 'block') {
            status.style.display = 'none';
            btn.innerText = "ğŸ¤ Ø¢ÙˆØ§Ø² Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº";
        } else {
            status.style.display = 'block';
            btn.innerText = "ğŸ›‘ Ø¢ÙˆØ§Ø² Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº";
        }
    }

    function toggleRecording() {
        isRecording = !isRecording;
        const btn = document.getElementById('recordBtn');
        btn.innerText = isRecording ? "â¹ï¸ Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯ Ø±ÙˆÚ©ÛŒÚº" : "ğŸ”´ Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯";
        if(isRecording) alert("Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯ Ø´Ø±ÙˆØ¹ ÛÙˆ Ú¯Ø¦ÛŒ ÛÛ’ (Ø³Ø³Ù¹Ù… Ù…ÛŒÙ…ÙˆØ±ÛŒ Ù…ÛŒÚº)");
    }

    function takeScreenshot() {
        renderer.render(scene, camera);
        const dataURL = renderer.domElement.toDataURL("image/png");
        const link = document.createElement('a');
        link.download = 'anime-studio-shot.png';
        link.href = dataURL;
        link.click();
    }

    function onWindowResize() {
        camera.aspect = (window.innerWidth - 380) / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth - 380, window.innerHeight);
    }

    function animate() {
        requestAnimationFrame(animate);
        if (autoRotate) {
            const rotSpeed = 0.01;
            const x = camera.position.x;
            const z = camera.position.z;
            camera.position.x = x * Math.cos(rotSpeed) + z * Math.sin(rotSpeed);
            camera.position.z = z * Math.cos(rotSpeed) - x * Math.sin(rotSpeed);
            camera.lookAt(0, 1, 0);
        }
        renderer.render(scene, camera);
    }
</script>
</body>
</html>
