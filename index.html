<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <title>Professional AI 3D Studio - Pro Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #050505; color: white; direction: rtl; overflow: hidden; }
        #container { display: flex; width: 100vw; height: 100vh; }
        #viewport { flex: 1; position: relative; background: radial-gradient(circle, #1a1a2e 0%, #000 100%); }
        #controls { width: 380px; background: #0f0f1e; padding: 25px; overflow-y: auto; border-left: 2px solid #ff6b9d; z-index: 10; }
        
        /* Avatar Creator Popup */
        #avatarFrame {
            display: none; position: fixed; top: 5%; left: 5%; width: 90%; height: 90%;
            background: white; border-radius: 20px; z-index: 1000; border: 5px solid #ff6b9d;
        }
        
        .section { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(255,107,157,0.2); }
        button { width: 100%; padding: 15px; margin: 8px 0; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; font-size: 14px; transition: 0.3s; }
        .ai-btn { background: linear-gradient(135deg, #00f2fe 0%, #4facfe 100%); color: white; }
        .ai-btn:hover { box-shadow: 0 0 20px #00f2fe; transform: translateY(-2px); }
        h1 { font-size: 22px; color: #ff6b9d; text-align: center; margin-bottom: 25px; text-shadow: 0 0 10px #ff6b9d; }
        #closeFrame { position: absolute; top: -15px; right: -15px; background: red; color: white; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; }
    </style>
</head>
<body>

<iframe id="avatarFrame" src=""></iframe>
<button id="closeFrame" onclick="hideCreator()" style="display:none">X</button>

<div id="container">
    <div id="viewport">
        <div style="position:absolute; top:20px; right:20px; background:rgba(0,0,0,0.6); padding:10px; border-radius:5px;">
            FPS: <span id="fps">60</span> | Ù…Ø§ÚˆÙ„: <span id="modelCount">0</span>
        </div>
    </div>
    
    <div id="controls">
        <h1>ğŸŒ AI Ø®ÙˆØ¯Ú©Ø§Ø± ØªÚ¾Ø±ÛŒ ÚˆÛŒ Ø§Ø³Ù¹ÙˆÚˆÛŒÙˆ</h1>

        <div class="section">
            <h3>ğŸ¤– AI Ø¢Ù¹Ùˆ Ú©Ø±ÛŒÚ©Ù¹Ø± Ú©Ø±Ø¦ÛŒÙ¹Ø±</h3>
            <p style="font-size:12px; color:#aaa; margin-bottom:10px;">ØªØµÙˆÛŒØ± Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚºØŒ AI Ø®ÙˆØ¯ Ø¨Ø®ÙˆØ¯ ØªÚ¾Ø±ÛŒ ÚˆÛŒ Ù…Ø§ÚˆÙ„ Ø¨Ù†Ø§ Ø¯Û’ Ú¯Ø§</p>
            <button class="ai-btn" onclick="showCreator()">ğŸ‘§ Ù„Ú‘Ú©ÛŒ / Ù„Ú‘Ú©Ø§ (ØªØµÙˆÛŒØ± Ø³Û’ Ø¨Ù†Ø§Ø¦ÛŒÚº)</button>
            <button class="ai-btn" onclick="showCreator()">ğŸ‘© Ù…Ø§Úº / Ø¨Ø§Ù¾ (ØªØµÙˆÛŒØ± Ø³Û’ Ø¨Ù†Ø§Ø¦ÛŒÚº)</button>
            <button onclick="removeAll()" style="background:#eb3349; color:white;">ØªÙ…Ø§Ù… Ú©Ø±Ø¯Ø§Ø± ÛÙ¹Ø§Ø¦ÛŒÚº</button>
        </div>

        <div class="section">
            <h3>ğŸï¸ Ø§Ø³Ù…Ø§Ø±Ù¹ Ù…Ø§Ø­ÙˆÙ„</h3>
            <button onclick="changeEnv('park')" style="background:#2d5a27; color:white;">ğŸŒ³ Ù¾Ø§Ø±Ú© (Ú¯Ø±ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ†)</button>
            <button onclick="changeEnv('city')" style="background:#334455; color:white;">ğŸ™ï¸ Ø¬Ø¯ÛŒØ¯ Ø´ÛØ±</button>
        </div>

        <div class="section">
            <h3>ğŸ¬ Ø§ÛŒÚ©Ø´Ù† Ú©Ù†Ù¹Ø±ÙˆÙ„</h3>
            <button onclick="playAction('dance')" style="background:#764ba2; color:white;">ğŸ’ƒ ÚˆØ§Ù†Ø³ Ø§ÛŒÚ©Ø´Ù†</button>
            <button onclick="playAction('walk')" style="background:#667eea; color:white;">ğŸš¶ Ú†Ù„Ù†Û’ Ú©Ø§ Ø§ÛŒÚ©Ø´Ù†</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
    let scene, camera, renderer, loader, mixer;
    let characters = [];

    // ÛŒÛ ÙˆÛ Ø³Ø±ÙˆØ³ ÛÛ’ Ø¬Ùˆ ØªØµÙˆÛŒØ± Ø³Û’ 3D Ø¨Ù†Ø§ØªÛŒ ÛÛ’
    const creatorURL = "https://demo.readyplayer.me/avatar?frameApi";

    window.onload = init;

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(50, (window.innerWidth - 380) / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 5);

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth - 380, window.innerHeight);
        document.getElementById('viewport').appendChild(renderer.domElement);

        const light = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(light);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(5, 10, 5);
        scene.add(dirLight);

        loader = new THREE.GLTFLoader();
        
        // Ø²Ù…ÛŒÙ†
        const grid = new THREE.GridHelper(100, 50, 0xff6b9d, 0x222222);
        scene.add(grid);

        window.addEventListener('message', subscribe); // AI Ø³Ø±ÙˆØ³ Ø³Û’ Ù…Ø§ÚˆÙ„ ÙˆØµÙˆÙ„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’
        animate();
    }

    function showCreator() {
        const frame = document.getElementById('avatarFrame');
        const btn = document.getElementById('closeFrame');
        frame.src = creatorURL;
        frame.style.display = "block";
        btn.style.display = "block";
    }

    function hideCreator() {
        document.getElementById('avatarFrame').style.display = "none";
        document.getElementById('closeFrame').style.display = "none";
    }

    // AI Ø³Ø±ÙˆØ³ Ø¬Ø¨ Ù…Ø§ÚˆÙ„ Ø¨Ù†Ø§ Ù„Û’ Ú¯ÛŒØŒ ØªÙˆ ÛŒÛ ÙÙ†Ú©Ø´Ù† Ø§Ø³Û’ ÛŒÛØ§Úº ÙˆØµÙˆÙ„ Ú©Ø±Û’ Ú¯Ø§
    function subscribe(event) {
        const json = parse(event);
        if (json?.source === 'readyplayerme' && json?.eventName === 'v1.avatar.exported') {
            loadMesh(json.data.url); // Ù…Ø§ÚˆÙ„ Ú©Ø§ Ù„Ù†Ú© Ù…Ù„ Ú¯ÛŒØ§ØŒ Ø§Ø¨ Ø§Ø³Û’ Ø§Ø³Ú©Ø±ÛŒÙ† Ù¾Ø± Ù„Ø§Ø¦ÛŒÚº
            hideCreator();
        }
    }

    function parse(event) {
        try { return JSON.parse(event.data); } catch { return null; }
    }

    function loadMesh(url) {
        loader.load(url, (gltf) => {
            const model = gltf.scene;
            model.position.x = (characters.length * 1.5) - 1;
            scene.add(model);
            characters.push(model);
            document.getElementById('modelCount').innerText = characters.length;
            alert("âœ… AI Ù†Û’ Ø¢Ù¾ Ú©ÛŒ ØªØµÙˆÛŒØ± Ø³Û’ ØªÚ¾Ø±ÛŒ ÚˆÛŒ Ú©Ø±Ø¯Ø§Ø± ØªÛŒØ§Ø± Ú©Ø± Ø¯ÛŒØ§ ÛÛ’!");
        });
    }

    function changeEnv(type) {
        if(type === 'park') scene.background = new THREE.Color(0x2d5a27);
        else scene.background = new THREE.Color(0x050505);
    }

    function removeAll() {
        characters.forEach(c => scene.remove(c));
        characters = [];
        document.getElementById('modelCount').innerText = "0";
    }

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
</script>
</body>
</html>
