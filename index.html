<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Anime 3D Studio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            overflow: hidden;
            direction: rtl;
            color: white;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            display: flex;
        }
        
        #viewport {
            flex: 1;
            position: relative;
            background: #0f0f1e;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        #controls {
            width: 380px;
            background: rgba(15, 15, 30, 0.95);
            color: white;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(15px);
            border-left: 2px solid rgba(255, 107, 157, 0.3);
        }
        
        h1 {
            font-size: 22px;
            margin-bottom: 25px;
            text-align: center;
            color: #ff6b9d;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.6);
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 107, 157, 0.3);
        }
        
        .section {
            margin-bottom: 20px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s;
        }
        
        .section:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 107, 157, 0.3);
        }
        
        .section h3 {
            font-size: 15px;
            margin-bottom: 15px;
            color: #ffd93d;
            border-bottom: 2px solid rgba(255, 217, 61, 0.3);
            padding-bottom: 10px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            margin: 6px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .character-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin: 4px 0;
            padding: 10px;
            font-size: 13px;
        }
        
        #scriptInput {
            width: 100%;
            height: 120px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 13px;
            resize: vertical;
            margin: 10px 0;
            font-family: inherit;
        }
        
        #scriptInput:focus {
            outline: none;
            border-color: #ff6b9d;
            box-shadow: 0 0 15px rgba(255, 107, 157, 0.4);
        }
        
        .camera-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 10px 0;
        }
        
        .camera-btn {
            padding: 8px;
            font-size: 12px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        #voiceStatus {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #4ade80;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: bold;
            display: none;
            z-index: 1000;
            animation: pulse 2s infinite;
            border: 2px solid #4ade80;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 20px rgba(74, 222, 128, 0.4); }
            50% { opacity: 0.8; box-shadow: 0 0 30px rgba(74, 222, 128, 0.6); }
        }
        
        .recording {
            background: rgba(239, 68, 68, 0.9) !important;
            color: white !important;
            border-color: #ef4444 !important;
        }
        
        #stats {
            position: fixed;
            bottom: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.8);
            color: #4ade80;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }
        
        label {
            display: block;
            font-size: 13px;
            margin: 10px 0 6px;
            color: #ddd;
        }
        
        select {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 13px;
            cursor: pointer;
            margin: 5px 0;
        }
        
        select:focus {
            outline: none;
            border-color: #ff6b9d;
        }
        
        .info-text {
            font-size: 11px;
            color: #888;
            line-height: 1.6;
            margin-top: 8px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 157, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 157, 0.7);
        }
    </style>
</head>
<body>
    <div id="voiceStatus">ğŸ¤ Ø¢ÙˆØ§Ø² Ø³Ù† Ø±ÛØ§ ÛÙˆÚº...</div>
    <div id="stats">FPS: 60 | Ú©Ø±Ø¯Ø§Ø±: 0 | Ú©ÛŒÙ…Ø±Û: ÙØ±Ù†Ù¹</div>
    
    <div id="container">
        <div id="viewport"></div>
        
        <div id="controls">
            <h1>ğŸŒ Ù¾Ø±ÙˆÙÛŒØ´Ù†Ù„ Ø§ÛŒÙ†ÛŒÙ…ÛŒ ØªÚ¾Ø±ÛŒ ÚˆÛŒ Ø§Ø³Ù¹ÙˆÚˆÛŒÙˆ</h1>
            
            <!-- Characters -->
            <div class="section">
                <h3>ğŸ‘¥ Ú©Ø±Ø¯Ø§Ø± Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</h3>
                <button class="character-btn" onclick="addCharacter('girl')">ğŸ‘§ 18 Ø³Ø§Ù„Û Ù„Ú‘Ú©ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                <button class="character-btn" onclick="addCharacter('boy')">ğŸ‘¦ 18 Ø³Ø§Ù„Û Ù„Ú‘Ú©Ø§ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                <button class="character-btn" onclick="addCharacter('mother')">ğŸ‘© Ù…Ø§Úº (35 Ø³Ø§Ù„)</button>
                <button class="character-btn" onclick="addCharacter('father')">ğŸ‘¨ Ø¨Ø§Ù¾ (40 Ø³Ø§Ù„)</button>
                <button onclick="removeLastCharacter()" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">Ú©Ø±Ø¯Ø§Ø± ÛÙ¹Ø§Ø¦ÛŒÚº</button>
                <label>Ù…ÙˆØ¬ÙˆØ¯Û Ú©Ø±Ø¯Ø§Ø±: <span id="charCount">0</span></label>
            </div>
            
            <!-- AI Script Control -->
            <div class="section">
                <h3>âœ¨ AI Ø§Ø³Ú©Ø±Ù¾Ù¹ Ú©Ù†Ù¹Ø±ÙˆÙ„ (Ù†ÛŒØ§!)</h3>
                <textarea id="scriptInput" placeholder="ÛŒÛØ§Úº Ø§Ù¾Ù†ÛŒ Ø§Ø³Ú©Ø±Ù¾Ù¹ Ù„Ú©Ú¾ÛŒÚº... Ù…Ø«Ø§Ù„:
â€¢ Ù„Ú‘Ú©ÛŒ Ù¾Ø§Ø±Ú© Ù…ÛŒÚº Ú†Ù„ Ø±ÛÛŒ ÛÛ’
â€¢ Ù„Ú‘Ú©Ø§ Ø¯ÙˆÚ‘ØªØ§ ÛÛ’ Ø§ÙˆØ± ÛØ§ØªÚ¾ ÛÙ„Ø§ØªØ§ ÛÛ’
â€¢ Ø¨Ø§Ù¾ Ø¨ÛŒÙ¹Ú¾ Ú©Ø± Ø§Ø®Ø¨Ø§Ø± Ù¾Ú‘Ú¾ Ø±ÛØ§ ÛÛ’
â€¢ Ù…Ø§Úº Ú©Ú†Ù† Ù…ÛŒÚº Ú©Ú¾Ø§Ù†Ø§ Ø¨Ù†Ø§ Ø±ÛÛŒ ÛÛ’"></textarea>
                <button onclick="executeScript()" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">ğŸ¬ Ø§Ø³Ú©Ø±Ù¾Ù¹ Ú†Ù„Ø§Ø¦ÛŒÚº</button>
                <button onclick="stopAllActions()">â¹ï¸ ØªÙ…Ø§Ù… Ø­Ø±Ú©Ø§Øª Ø±ÙˆÚ©ÛŒÚº</button>
                <div class="info-text">
                    ğŸ’¡ <strong>Ù¹Ù¾:</strong> Ø¢Ù¾ Ú©Ø±Ø¯Ø§Ø± Ú©ÛŒ Ø­Ø±Ú©Ø§ØªØŒ Ù…Ù‚Ø§Ù… Ø§ÙˆØ± Ø§ÛŒÚ©Ø´Ù† Ú©ÛŒ ØªÙØµÛŒÙ„ Ù„Ú©Ú¾ÛŒÚºÛ” AI Ø®ÙˆØ¯Ú©Ø§Ø± Ø·Ø±ÛŒÙ‚Û’ Ø³Û’ Ø³ÛŒÙ† Ø¨Ù†Ø§Ø¦Û’ Ú¯Ø§!
                </div>
            </div>
            
            <!-- Environment -->
            <div class="section">
                <h3>ğŸï¸ Ù…Ø§Ø­ÙˆÙ„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</h3>
                <button onclick="changeEnvironment('city')">ğŸ™ï¸ Ø´ÛØ± (15 Ú©Ù„ÙˆÙ…ÛŒÙ¹Ø±)</button>
                <button onclick="changeEnvironment('town')">ğŸ˜ï¸ Ù‚ØµØ¨Û/Ú¯Ø§Ø¤Úº</button>
                <button onclick="changeEnvironment('park')">ğŸŒ³ Ù¾Ø§Ø±Ú©</button>
                <button onclick="changeEnvironment('forest')">ğŸŒ² Ø¬Ù†Ú¯Ù„</button>
                <label>Ù…ÙˆØ¬ÙˆØ¯Û Ù…Ø§Ø­ÙˆÙ„: <span id="envName">Ø´ÛØ±</span></label>
            </div>
            
            <!-- Camera Controls -->
            <div class="section">
                <h3>ğŸ“¹ Ú©ÛŒÙ…Ø±Û Ú©Ù†Ù¹Ø±ÙˆÙ„</h3>
                <div class="camera-controls">
                    <button class="camera-btn" onclick="setCameraAngle('front')">ÙØ±Ù†Ù¹</button>
                    <button class="camera-btn" onclick="setCameraAngle('back')">Ø¨ÛŒÚ©</button>
                    <button class="camera-btn" onclick="setCameraAngle('side')">Ø³Ø§Ø¦ÛŒÚˆ</button>
                    <button class="camera-btn" onclick="setCameraAngle('top')">Ù¹Ø§Ù¾</button>
                    <button class="camera-btn" onclick="setCameraAngle('aerial')">ÛÙˆØ§Ø¦ÛŒ Ù†Ø¸Ø§Ø±Û</button>
                    <button class="camera-btn" onclick="setCameraAngle('closeup')">Ú©Ù„ÙˆØ² Ø§Ù¾</button>
                </div>
                <button onclick="toggleCameraRotation()">ğŸ”„ Ø¢Ù¹Ùˆ Ø±ÙˆÙ¹ÛŒÙ¹: <span id="rotateStatus">Ø¢Ù</span></button>
            </div>
            
            <!-- Voice Control -->
            <div class="section">
                <h3>ğŸ¤ Ø¢ÙˆØ§Ø² Ø³Û’ Ú©Ù†Ù¹Ø±ÙˆÙ„</h3>
                <label>Ú©Ø±Ø¯Ø§Ø± Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
                <select id="voiceCharSelect">
                    <option value="all">ØªÙ…Ø§Ù… Ú©Ø±Ø¯Ø§Ø±</option>
                    <option value="0">Ú©Ø±Ø¯Ø§Ø± 1</option>
                    <option value="1">Ú©Ø±Ø¯Ø§Ø± 2</option>
                    <option value="2">Ú©Ø±Ø¯Ø§Ø± 3</option>
                    <option value="3">Ú©Ø±Ø¯Ø§Ø± 4</option>
                </select>
                <button id="voiceBtn" onclick="toggleVoiceControl()">ğŸ™ï¸ Ø¢ÙˆØ§Ø² Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</button>
                <div class="info-text">
                    Ù…Ù†ØªØ®Ø¨ Ú©Ø±Ø¯Ø§Ø± Ø¢Ù¾ Ú©ÛŒ Ø¢ÙˆØ§Ø² Ø¯ÛØ±Ø§Ø¦Û’ Ú¯Ø§
                </div>
            </div>
            
            <!-- Video Recording -->
            <div class="section">
                <h3>ğŸ¥ ÙˆÛŒÚˆÛŒÙˆ Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯</h3>
                <button id="recordBtn" onclick="toggleRecording()">ğŸ”´ Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</button>
                <button onclick="takeScreenshot()">ğŸ“¸ Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let characters = [];
        let environment = 'city';
        let cameraAngle = 'front';
        let isVoiceActive = false;
        let isRecording = false;
        let autoRotate = false;
        let animationFrame = 0;
        
        // Character templates
        const characterTypes = {
            girl: { color: 0xffb3d9, hairColor: 0xff1493, height: 1.65, age: 18 },
            boy: { color: 0xadd8e6, hairColor: 0x654321, height: 1.75, age: 18 },
            mother: { color: 0xffd1dc, hairColor: 0x8b4513, height: 1.60, age: 35 },
            father: { color: 0xb0c4de, hairColor: 0x2f4f4f, height: 1.80, age: 40 }
        };
        
        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x87ceeb, 20, 100);
            
            camera = new THREE.PerspectiveCamera(60, (window.innerWidth - 380) / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 3, 10);
            camera.lookAt(0, 1, 0);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth - 380, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('viewport').appendChild(renderer.domElement);
            
            const ambLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambLight);
            
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(10, 15, 10);
            dirLight.castShadow = true;
            dirLight.shadow.mapSize.width = 1024;
            dirLight.shadow.mapSize.height = 1024;
            dirLight.shadow.camera.near = 0.5;
            dirLight.shadow.camera.far = 50;
            scene.add(dirLight);
            
            const hemiLight = new THREE.HemisphereLight(0x87ceeb, 0x90ee90, 0.5);
            scene.add(hemiLight);
            
            createGround();
            changeEnvironment('city');
            
            window.addEventListener('resize', onWindowResize);
            animate();
            
            console.log('âœ… Professional Anime Studio Initialized!');
        }
        
        function createGround() {
            const groundGeo = new THREE.PlaneGeometry(200, 200, 50, 50);
            const groundMat = new THREE.MeshStandardMaterial({ 
                color: 0x7cb342,
                roughness: 0.8,
                metalness: 0.2
            });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
        }
        
        function createAnimeCharacter(type, position = { x: 0, z: 0 }) {
            const template = characterTypes[type];
            const char = new THREE.Group();
            
            const scale = template.height / 1.70;
            
            // Head (anime style - larger)
            const headGeo = new THREE.SphereGeometry(0.35 * scale, 32, 32);
            const skinMat = new THREE.MeshStandardMaterial({ 
                color: 0xffdbac,
                roughness: 0.4,
                metalness: 0.1
            });
            const head = new THREE.Mesh(headGeo, skinMat);
            head.position.y = 1.65 * scale;
            head.scale.set(1, 1.1, 0.95);
            head.castShadow = true;
            char.add(head);
            
            // Large anime eyes
            const eyeGeo = new THREE.SphereGeometry(0.08 * scale, 16, 16);
            const eyeWhiteMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            
            const leftEye = new THREE.Mesh(eyeGeo, eyeWhiteMat);
            leftEye.position.set(-0.15 * scale, 1.7 * scale, 0.3 * scale);
            leftEye.scale.set(1.2, 1.5, 0.8);
            char.add(leftEye);
            
            const rightEye = new THREE.Mesh(eyeGeo, eyeWhiteMat);
            rightEye.position.set(0.15 * scale, 1.7 * scale, 0.3 * scale);
            rightEye.scale.set(1.2, 1.5, 0.8);
            char.add(rightEye);
            
            // Pupils
            const pupilGeo = new THREE.SphereGeometry(0.04 * scale, 16, 16);
            const pupilMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });
            
            const leftPupil = new THREE.Mesh(pupilGeo, pupilMat);
            leftPupil.position.set(-0.15 * scale, 1.7 * scale, 0.35 * scale);
            char.add(leftPupil);
            
            const rightPupil = new THREE.Mesh(pupilGeo, pupilMat);
            rightPupil.position.set(0.15 * scale, 1.7 * scale, 0.35 * scale);
            char.add(rightPupil);
            
            // Anime hair (spiky/stylized)
            const hairGeo = new THREE.SphereGeometry(0.4 * scale, 16, 16);
            const hairMat = new THREE.MeshStandardMaterial({ 
                color: template.hairColor,
                roughness: 0.6
            });
            const hair = new THREE.Mesh(hairGeo, hairMat);
            hair.position.y = 1.9 * scale;
            hair.scale.set(1.1, 0.8, 1.1);
            char.add(hair);
            
            // Body (slim anime style)
            const bodyGeo = new THREE.CylinderGeometry(0.25 * scale, 0.28 * scale, 1 * scale, 16);
            const clothMat = new THREE.MeshStandardMaterial({ 
                color: template.color,
                roughness: 0.5
            });
            const body = new THREE.Mesh(bodyGeo, clothMat);
            body.position.y = 1 * scale;
            body.castShadow = true;
            char.add(body);
            
            // Arms
            const armGeo = new THREE.CylinderGeometry(0.06 * scale, 0.06 * scale, 0.7 * scale, 12);
            
            const leftArm = new THREE.Mesh(armGeo, skinMat);
            leftArm.position.set(-0.35 * scale, 1.2 * scale, 0);
            leftArm.rotation.z = 0.2;
            leftArm.castShadow = true;
            char.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeo, skinMat);
            rightArm.position.set(0.35 * scale, 1.2 * scale, 0);
            rightArm.rotation.z = -0.2;
            rightArm.castShadow = true;
            char.add(rightArm);
            
            // Legs
            const legGeo = new THREE.CylinderGeometry(0.08 * scale, 0.07 * scale, 0.8 * scale, 12);
            
            const leftLeg = new THREE.Mesh(legGeo, clothMat);
            leftLeg.position.set(-0.12 * scale, 0.4 * scale, 0);
            leftLeg.castShadow = true;
            char.add(leftLeg);
            
            const rightLeg = new THREE.Mesh(legGeo, clothMat);
            rightLeg.position.set(0.12 * scale, 0.4 * scale, 0);
            rightLeg.castShadow = true;
            char.add(rightLeg);
            
            char.position.set(position.x, 0, position.z);
            
            char.userData = {
                type, head, hair, leftArm, rightArm, leftLeg, rightLeg, body,
                leftEye, rightEye, leftPupil, rightPupil,
                action: 'idle',
                actionTime: 0,
                targetPos: { x: position.x, z: position.z },
                speech: ''
            };
            
            scene.add(char);
            characters.push(char);
            updateCharCount();
            
            return char;
        }
        
        function addCharacter(type) {
            if (characters.length >= 4) {
                alert('âš ï¸ Ø²ÛŒØ§Ø¯Û Ø³Û’ Ø²ÛŒØ§Ø¯Û 4 Ú©Ø±Ø¯Ø§Ø±!');
                return;
            }
            
            const positions = [
                { x: -3, z: 0 },
                { x: -1, z: 0 },
                { x: 1, z: 0 },
                { x: 3, z: 0 }
            ];
            
            const pos = positions[characters.length];
            createAnimeCharacter(type, pos);
            console.log(`âœ… ${type} Ú©Ø±Ø¯Ø§Ø± Ø´Ø§Ù…Ù„ Ú©ÛŒØ§ Ú¯ÛŒØ§`);
        }
        
        function removeLastCharacter() {
            if (characters.length === 0) return;
            const char = characters.pop();
            scene.remove(char);
            updateCharCount();
        }
        
        function updateCharCount() {
            document.getElementById('charCount').textContent = characters.length;
            updateStats();
        }
        
        function executeScript() {
            const script = document.getElementById('scriptInput').value.trim();
            if (!script) {
                alert('âš ï¸ Ù¾ÛÙ„Û’ Ø§Ø³Ú©Ø±Ù¾Ù¹ Ù„Ú©Ú¾ÛŒÚº!');
                return;
            }
            
            console.log('ğŸ¬ Ø§Ø³Ú©Ø±Ù¾Ù¹ Ú†Ù„ Ø±ÛÛŒ ÛÛ’:', script);
            
            const lines = script.split('\n').filter(l => l.trim());
            
            lines.forEach((line, index) => {
                setTimeout(() =
